<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Card Display</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Scrollbar for the specific div */
        .overflow-x-auto::-webkit-scrollbar {
            display: none;
            height: 8px;
            /* Scrollbar height */
        }

        .overflow-x-auto::-webkit-scrollbar-track {
            background: #f1f1f1;
            /* Track background */
            border-radius: 10px;
        }

        .overflow-x-auto::-webkit-scrollbar-thumb {
            background-color: #66ccff;
            /* Scrollbar thumb color */
            border-radius: 10px;
            border: 2px solid #f1f1f1;
            /* Thumb border */
        }

        .overflow-x-auto::-webkit-scrollbar-thumb:hover {
            background-color: #66ccff;
            /* Scrollbar thumb hover color */
        }

        body,
        html {
            overflow: hidden;
            /* Hides the scrollbars */
            height: 100%;
            /* Ensures the body and html are at least 100% height */
            font-feature-settings: "lnum";
            font-variant-numeric: tabular-nums;
        }

        .card {
            transform: translateY(-10px);
            /* Slightly move the card up */
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            /* Increase shadow on hover */
        }


        .side-image {
            flex-shrink: 0;
            width: 80px;
            height: 100px;
            object-fit: contain;
            margin: 0 10px;
        }

        /* 第一段 HTML 的 CSS */
        .time {
            position: absolute;
            top: 0px;
            right: 175px;
            width: 300px;
            height: 120px;
            text-align: center;
            font-family: Microsoft Yahei;
            font-weight: 1000;
            letter-spacing: -4px;
            font-size: 75px;
            color: #FFFFFF;
            display: inline;
            line-height: 120px;
            text-indent: 0px;
            text-shadow: 3px 3px 0px #1300b8d1;
            transition: text-shadow 0.5s;
        }

        .date {
            position: absolute;
            top: -9px;
            right: 0px;
            margin-right: -30px;
            width: 500px;
            height: 120px;
            font-family: Microsoft Yahei;
            font-weight: 1000;
            letter-spacing: -14px;
            font-size: 130px;
            color: #0f008a;
            display: inline;
            line-height: 100px;
            text-align: center;
            overflow: hidden;
            transition: color 0.5s;
        }

        .bg-clip {
            position: absolute;
            top: -9px;
            right: 0px;
            margin-right: -30px;
            font-family: Microsoft Yahei;
            font-weight: 1000;
            letter-spacing: -14px;
            font-size: 130px;
            color: #00ffd9;
            line-height: 100px;
            text-align: center;
            position: absolute;
            width: 500px;
            height: 120px;
            display: inline;
            background-image: url("{{ url_for('static', filename='images/wave5.png') }}");
            background-size: cover;
            -webkit-background-clip: text;
            color: transparent;
            animation: scrollbg 10s linear infinite;
            overflow: hidden;
            transition: background-image 0.5s;
        }

        .d1 {
            background-image: url("{{ url_for('static', filename='images/wave5.png') }}");
        }

        .d2 {
            background-image: url("{{ url_for('static', filename='images/wave6.png') }}");
        }

        .d3 {
            background-image: url("{{ url_for('static', filename='images/wave7.png') }}");
        }

        .d4 {
            background-image: url("{{ url_for('static', filename='images/wave8.png') }}");
        }

        @keyframes scrollbg {
            0% {
                background-position: 500px 9px;
            }

            50% {
                background-position: 250px 9px;
            }

            100% {
                background-position: 0px 9px;
            }
        }

        .container1 {
            position: absolute;
            width: 500px;
            height: 140px;
            right: 0px;
            margin-right: -30px;
            -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3CforeignObject width='100%25' height='100%25'%3E%3Cbody class='wrap' xmlns='http://www.w3.org/1999/xhtml'%3E%3Cstyle%3E.wrap%7Bbox-sizing:border-box;margin-left:0px;height:100%25;width:100%25;padding:0px 0px 40px 30px%7D.shadow%7Bheight:100%25;background:black;border-radius:60px;box-shadow:0 0 5px black ,0 0 10px black, 0 0 15px black,0 0 20px black, 0 0 25px black,0 0 30px black,0 0 28px black %7D%3C/style%3E%3Cdiv class='shadow'/%3E%3C/body%3E%3C/foreignObject%3E%3C/svg%3E");
            /* 移除 overflow: hidden; 或调整遮罩图像的高度 */
            /* overflow: hidden; */
        }

        /* 如果需要保留混合效果，可以将其应用到子元素 */
        .container1 .inner-content {
            mix-blend-mode: hard-light;
            /* 将混合效果限制在子元素 */
        }

        .img1 {
            width: 500px;
            height: 140px;
            display: inline;
            position: absolute;
            animation: scrollImage1 10s linear infinite;
        }

        @keyframes scrollImage1 {
            0% {
                transform: translateX(0%);
            }

            50% {
                transform: translateX(-50%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        .img2 {
            width: 500px;
            height: 140px;
            display: inline;
            position: absolute;
            animation: scrollImage2 10s linear infinite;
        }

        @keyframes scrollImage2 {
            0% {
                transform: translateX(100%);
            }

            50% {
                transform: translateX(50%);
            }

            100% {
                transform: translateX(0%);
            }
        }

        .circle1 {
            width: 80px;
            height: 80px;
            right: 40px;
            top: 45px;
            background-color: #ffd200;
            display: inline;
            position: absolute;
            border-radius: 50%;
            box-shadow: 0px 0px 3px #402b00;
        }

        .circle2 {
            width: 76px;
            height: 76px;
            right: 42px;
            top: 47px;
            background-color: #ffe500;
            display: inline;
            position: absolute;
            border-radius: 50%;
            box-shadow: 0px 0px 10px #fff72a, 0px 0px 20px #fff72a;
        }

        .sphere {
            border-radius: 100%;
            width: 76px;
            height: 76px;
            right: 42px;
            top: 47px;
            display: flex;
            overflow: hidden;
            align-items: center;
            position: absolute;
        }

        .hemisphere {
            width: 50%;
            height: 100%;
        }

        .light {
            background-color: #ffe700;
        }

        .dark {
            background-color: #302c24;
        }

        .divider,
        .divider:after {
            top: 0px;
            right: 0px;
            width: 76px;
            height: 76px;
            position: absolute;
            border-radius: 100%;
            transform-style: preserve-3d;
            backface-visibility: hidden;
        }

        .divider {
            background-color: #302c24;
        }

        .divider:after {
            content: '';
            background-color: #ffe700;
            transform: rotateY(180deg);
        }

        .phasename {
            position: absolute;
            width: 95px;
            top: 38px;
            right: 100px;
            text-align: center;
            font-family: SimHei;
            font-weight: 1000;
            letter-spacing: 1px;
            font-size: 22px;
            color: #fffb9f;
            text-shadow: 1px 1px 1px #635400d9;
        }

        .daytime {
            position: absolute;
            width: 80px;
            top: 80px;
            right: 118px;
            text-align: center;
            font-family: Microsoft Yahei;
            font-weight: 1000;
            letter-spacing: -2px;
            font-size: 25px;
            color: #00fdff;
            text-shadow: -2px -2px 2px #002c90, 2px -2px 2px #002c90, -2px 2px 2px #002c90, 2px 2px 2px #002c90;
            transition: color 0.5s;
        }

        .triangle {
            position: absolute;
            top: 55px;
            right: 180px;
            width: 0;
            height: 0;
            border-left: 25px solid transparent;
            border-right: 25px solid transparent;
            border-top: 43.3px solid black;
        }

        .triangle-box {
            position: absolute;
            width: 50px;
            height: 43.3px;
            top: 55px;
            right: 180px;
            -webkit-mask: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 86.6025'%3E%3Cpolygon points='100 0, 0 0,0 86.6025,50 86.6025'/%3E%3C/svg%3E");
            overflow: hidden;
        }

        .weekday {
            position: absolute;
            width: 50px;
            height: 43.3px;
            top: -3px;
            right: 5px;
            text-align: center;
            font-family: Microsoft Yahei;
            font-weight: 1000;
            letter-spacing: 0px;
            font-size: 35px;
            color: #ffffff;
            text-shadow: 1px 1px 1px #0021ff;
        }

        .card {
            opacity: 0;
            /* 初始状态不可见 */
            transform: translateY(50px);
            /* 初始位置在下方 */
            transition: opacity 0.6s ease-out, transform 0.6s ease-out;
        }

        .card.visible {
            opacity: 1;
            /* 逐渐显示 */
            transform: translateY(0);
            /* 回到正常位置 */
        }

        /* 当卡片离开视口时，向下滑出并淡出 */
        .card.exit {
            opacity: 0;
            transform: translateY(50px);
        }
    </style>
</head>

<body class="bg-cover bg-center bg-no-repeat">
    <video autoplay muted loop class="fixed top-0 left-0 w-full h-full object-cover z-[-1]">
        <source src="{{ url_for('static', filename='videos/Persona 3 Reload 无缝循环10 Minute.mp4') }}" type="video/mp4">
    </video>
    <div class="container mx-auto">
        <div class="flex items-center justify-between">

            <div class="flex items-center space-x-4 justify-center flex-grow">
                <img src="{{ url_for('static', filename='images/IMG_5283.PNG') }}" alt="Left Image"
                    class="side-image w-16 h-16">
                <h1 class="text-5xl font-bold text-center">
                    <span class="font-serif text-black">Made By:</span>
                    <span style="font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;">Cc专心破译</span>
                </h1>
            </div>

            <div style="position: relative; z-index: 1000; transform: scale(0.7);">
                <span class="date">{{date_str}}</span>
                <div class="container1">
                    <img src="{{ url_for('static', filename='images/wave1.png') }}" class="img1" alt="1"
                        id="wave1"></img>
                    <img src="{{ url_for('static', filename='images/wave1.png') }}" class="img2" alt="1"
                        id="wave2"></img>
                    <img src="{{ url_for('static', filename='images/wave2.png') }}" class="img1" alt="2"
                        id="wave3"></img>
                    <img src="{{ url_for('static', filename='images/wave2.png') }}" class="img2" alt="2"
                        id="wave4"></img>
                    <img src="{{ url_for('static', filename='images/wave3.png') }}" class="img1" alt="3"
                        id="wave5"></img>
                    <img src="{{ url_for('static', filename='images/wave3.png') }}" class="img2" alt="3"
                        id="wave6"></img>
                    <img src="{{ url_for('static', filename='images/wave4.png') }}" class="img1" alt="4"
                        id="wave7"></img>
                    <img src="{{ url_for('static', filename='images/wave4.png') }}" class="img2" alt="4"
                        id="wave8"></img>
                </div>
                <div class="date bg-clip d4" id="date5">zxpy</div>
                <div class="date bg-clip d3" id="date4">zxpy</div>
                <div class="date bg-clip d2" id="date3">zxpy</div>
                <div class="date bg-clip d1" id="date2">zxpy</div>

                <div class="triangle" id="triangle"></div>
                <div class="triangle-box">
                    <div class="weekday">{{weekday_str}}</div>
                </div>
                <span class="time" style="font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;">{{type_name}}</span>
                <div class="phasename font-serif">{{ phasename }}</div>
                <div class="daytime" style="font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;">{{time_stage}}</div>

                <!-- <div class="triangle-box">
                    <div class="weekday" id="weekday">几</div>
                </div>
                <span id="time" class="time">TIME</span>
                <div class="phasename" id="phasename">PHASE</div>
                <div class="daytime" id="daytime">STEP</div> -->


                <div class="circle1"></div>
                <div class="circle2"></div>
                <div class="sphere">
                    <div class="light hemisphere"></div>
                    <div class="dark hemisphere"></div>
                    <div class="divider"></div>
                </div>
            </div>
        </div>
        <!-- 父容器使用 Flexbox 布局 -->


        <div class="max-w-full overflow-x-auto bg-transparent bg-opacity-50 p-4 rounded-lg shadow-lg"
            id="scroll-container">
            <div class="flex space-x-6 w-max">
                {% for card in cards %}
                <div
                    class="card bg-[#F5F5DC]/90 backdrop-blur-md p-4 rounded-lg shadow-2xl h-[700px] w-80 flex flex-col relative border-2 border-[#D2B48C]/50">
                    <!-- 卡片内容 -->

                    <!-- 图片容器 -->
                    <div class="flex items-center justify-center overflow-hidden rounded-md h-80">
                        <img src="{{ card.path_to_cbg }}" alt="{{ card.name }}"
                            class="max-w-full max-h-full object-contain">
                    </div>
                    <h2 class="text-3xl font-semibold mt-4 flex items-center justify-start space-x-2">
                        <span class="text-black-400" style="font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;">排名</span>
                        <span class="font-bold text-blue-600 font-serif">:{{ card.rank_by_new }}</span>
                        <span class="flex items-center">
                            <!-- 箭头图标 -->
                            <svg xmlns="http://www.w3.org/2000/svg"
                                class="h-6 w-6 {{ 'text-red-600' if card.rank_dif >= 0 else 'text-gray-600 rotate-180' }}"
                                viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                            <!-- 差值 -->
                            <span class="{{ 'text-red-600' if card.rank_dif >= 0 else 'text-gray-600' }} font-serif">{{
                                card.rank_check }}</span>
                        </span>
                    </h2>
                    <p class="text-3xl font-semibold mt-4 flex items-center justify-start space-x-2">
                        <span class="text-black-400" style="font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;">价格</span>
                        <span class="font-bold text-blue-600 font-serif">:{{ card.price_new }}</span>
                        <span class="flex items-center">
                            <!-- 箭头图标 -->
                            <svg xmlns="http://www.w3.org/2000/svg"
                                class="h-6 w-6 {{ 'text-red-600' if card.price_dif >= 0 else 'text-gray-600 rotate-180' }}"
                                viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z"
                                    clip-rule="evenodd" />
                            </svg>
                            <!-- 差值 -->
                            <span class="{{ 'text-red-600' if card.price_dif >= 0 else 'text-gray-600' }} font-serif">{{
                                card.price_check }}</span>
                        </span>
                    </p>
                    <div class="mt-4 text-left">
                        <span style="font-family: 'STKaiti', 'KaiTi', 'SimKai', serif;"
                            class="text-3xl font-semibold text-gray-800" id="seller-words-{{ loop.index }}">卖家说：{{
                            card.words }}</span>
                    </div>

                </div>
                {% endfor %}
            </div>
        </div>
    </div>


</body>

<script>
    const sellerWordsElements = document.querySelectorAll('[id^="seller-words-"]');
    const maxLength = 43; // 最大字数

    sellerWordsElements.forEach(element => {
        const fullText = element.textContent; // 获取完整文本
        const prefix = "卖家说："; // 固定前缀
        let content = fullText.slice(prefix.length); // 提取动态内容

        // 截取超长部分
        if (content.length > maxLength) {
            content = content.slice(0, maxLength) + '...';
        }

        // 设置不同颜色
        element.innerHTML = `<span class="text-gray-800">${prefix}</span><span class="text-blue-600">${content}</span>`;
    });
</script>


<!-- <script>
    function autoScroll() {
      const container = document.getElementById("scroll-container");
      const scrollSpeed = 2; // 每步滚动像素
      const scrollInterval = 100/6; // 滚动间隔（毫秒）
      const stopDuration = 3000; // 初始停留时间
      
      let lastScrollTime = 0;
      let animationId;
      let isScrolling = false;
    
      // 滚动步骤（RAF优化版）
      function scrollStep(timestamp) {
        if (!isScrolling) return;
        
        // 时间间隔检查
        if (timestamp - lastScrollTime >= scrollInterval) {
          container.scrollLeft += scrollSpeed;
          lastScrollTime = timestamp;
          
        }
        
        animationId = requestAnimationFrame(scrollStep);
      }
    
      // 启动滚动
      function startScroll() {
        isScrolling = true;
        lastScrollTime = performance.now(); // 精确时间戳
        animationId = requestAnimationFrame(scrollStep);
      }
    
      // 停止滚动
      function stopScroll() {
        cancelAnimationFrame(animationId);
        isScrolling = false;
      }
    
      // 初始延迟启动
      setTimeout(startScroll, stopDuration);
    
    
      // 清理资源
      window.addEventListener('beforeunload', () => {
        cancelAnimationFrame(animationId);
      });
    }
    
    // 优化启动时机
    document.addEventListener('DOMContentLoaded', autoScroll);
</script> -->
    

<script>
    function autoScroll() {
        const container = document.getElementById("scroll-container");
        const scrollSpeed = 90; // 改为像素/秒（原2px/16.67ms ≈120px/s）
        const scrollInterval = 100/6;
        const stopDuration = 3000;
    
        let lastScrollTime = 0;
        let animationId;
        let isScrolling = false;
        let accumulatedScroll = 0; // 新增亚像素累积变量
    
        function scrollStep(timestamp) {
            if (!isScrolling) return;
    
            // 关键修改：基于时间差计算滚动量
            const deltaTime = timestamp - lastScrollTime;
            const pixelsToScroll = (scrollSpeed * deltaTime) / 1000;
    
            // 亚像素累积逻辑（避免卡顿）
            accumulatedScroll += pixelsToScroll;
            const integerScroll = Math.floor(accumulatedScroll);
            
            if (integerScroll > 0) {
                container.scrollLeft += integerScroll;
                accumulatedScroll -= integerScroll;
            }
    
            lastScrollTime = timestamp;
            animationId = requestAnimationFrame(scrollStep);
        }
    
        function startScroll() {
            isScrolling = true;
            accumulatedScroll = 0; // 重置累积值
            lastScrollTime = performance.now();
            animationId = requestAnimationFrame(scrollStep);
        }
    
        // 其余代码完全保持不变
        function stopScroll() {
            cancelAnimationFrame(animationId);
            isScrolling = false;
        }
    
        setTimeout(startScroll, stopDuration);
    
        window.addEventListener('beforeunload', () => {
            cancelAnimationFrame(animationId);
        });
    }
    
    document.addEventListener('DOMContentLoaded', autoScroll);
</script>
    


<script>
    const setMoonRotation = deg => {
        document.querySelector('.divider').style.transform = `rotate3d(0, 1, 0, ${deg}deg)`;

        const hemispheres = document.querySelectorAll('.hemisphere');

        if (deg < 180) {
            hemispheres[0].classList.remove('dark');
            hemispheres[0].classList.add('light');

            hemispheres[1].classList.add('dark');
            hemispheres[1].classList.remove('light');
        } else {
            hemispheres[0].classList.add('dark');
            hemispheres[0].classList.remove('light');

            hemispheres[1].classList.remove('dark');
            hemispheres[1].classList.add('light');
        }
    }
    var moondegree = {{ moondegree }};
    setMoonRotation(moondegree);
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const cards = document.querySelectorAll(".card");

        const observer = new IntersectionObserver((entries) => {
            entries.forEach((entry) => {
                if (entry.isIntersecting) {
                    entry.target.classList.add("visible");
                    entry.target.classList.remove("exit");
                } else {
                    // 当卡片开始离开视口时，立即执行滑出动画
                    entry.target.classList.add("exit");
                    entry.target.classList.remove("visible");
                }
            });
        }, { threshold: 0.3 }); // 当 30% 卡片进入/离开视口时触发

        cards.forEach((card) => {
            observer.observe(card);
        });
    });

</script>

</html>